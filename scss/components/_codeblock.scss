@import 'highlightjs';

@mixin nuxeo-codeblock {
  @include nuxeo-highlightjs;

  // Inline code
  code {
    border-radius: $code-border-radius;
    overflow-wrap: break-word;

    a > & {
      border: 1px solid;
    }
  }

  // Code block
  pre {
    background: $nuxeo-color-code-background;
    border: solid 2px $nuxeo-color-code-border;
    border-radius: $code-border-radius;
    color: $nuxeo-color-code-foreground;
    font-family: 'Courier 10 Pitch', Courier, monospace;
    font-size: 15px !important;
    line-height: 1.6;
    margin-bottom: 1.6em;
    max-width: 100%;
    overflow: auto;
    padding: 1.6em;
    position: relative;
    white-space: pre-wrap;

    .copy-area {
      position: absolute;
      right: 0;
      top: 0;
    }

    .copy-button {
      background-color: lighten($nuxeo-color-code-border, 15%);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      font-family: $body-font-family;
      margin: 4px;
      opacity: 0;
      padding: 4px 6px;
      transition: opacity .4s ease;

      &:hover {
        background-color: $nuxeo-color-code-border;
      }

      &.tooltipped {
        position: relative;
      }

      // This is the tooltip bubble
      &.tooltipped::after {
        -webkit-font-smoothing: subpixel-antialiased;
        background: $tooltip-background-color;
        border-radius: 3px;
        color: $tooltip-text-color;
        content: attr(aria-label);
        display: none;
        font-size: .8rem;
        letter-spacing: normal;
        opacity: 0;
        padding: 5px 8px;
        pointer-events: none;
        position: absolute;
        text-align: center;
        text-decoration: none;
        text-shadow: none;
        text-transform: none;
        white-space: pre;
        word-wrap: break-word;
        z-index: 1000000;
      }

      // This is the tooltip arrow
      &.tooltipped::before {
        border: 5px solid transparent;
        color: $tooltip-background-color;
        content: '';
        display: none;
        height: 0;
        opacity: 0;
        pointer-events: none;
        position: absolute;
        width: 0;
        z-index: 1000001;
      }

      // // delay animation for tooltip
      @keyframes tooltip-appear {
        from {
          opacity: 0;
        }

        to {
          opacity: 1;
        }
      }

      // This will indicate when we'll activate the tooltip
      &.tooltipped:hover,
      &.tooltipped:active,
      &.tooltipped:focus {
        &::before,
        &::after {
          animation-delay: $tooltip-delay;
          animation-duration: $tooltip-duration;
          animation-fill-mode: forwards;
          animation-name: tooltip-appear;
          animation-timing-function: ease-in;
          display: inline-block;
          text-decoration: none;
        }
      }

      // .tooltipped-no-delay:hover,
      // .tooltipped-no-delay:active,
      // .tooltipped-no-delay:focus {
      //   &::before,
      //   &::after {
      //     opacity: 1;
      //     animation: none;
      //   }
      // }


      // Tooltipped south
      &.tooltipped-sw {
        &::after {
          margin-top: 5px;
          right: 50%;
          top: 100%;
        }

        &::before {
          border-bottom-color: $tooltip-background-color;
          bottom: -5px;
          margin-right: -5px;
          right: 50%;
          top: auto;
        }
      }

      &.tooltipped-sw::after {
        margin-right: -15px;
      }
    }


    &:hover .copy-button {
      opacity: 1;
    }

    > code {
      background: transparent;
      border: 0;
      color: $nuxeo-color-code-foreground;

      > code {
        background: transparent;
      }
    }
  }

  // Code panel
  .code-heading {
    color: $header-color;
    font-family: $header-font-family;
    font-style: $header-font-style;
    font-weight: $header-font-weight;
    line-height: $header-lineheight;
    margin-bottom: -1rem;
    text-rendering: $header-text-rendering;

    p & {
      margin: 0;
    }

    // Ignore empty paragraphs added by Markdown
    ~ p:blank,
    ~ p:empty {
      display: none;
    }
  }

  // code-header - Same as h4
  @each $size, $headers in $header-sizes {
    @include breakpoint($size) {
      .code-heading {
        font-size: rem-calc(map-get($headers, 'h4'));
      }
    }
  }
}
